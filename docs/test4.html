<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>OSINT – Liste des contenus</title>
  <style>
    :root { --bg:#0b0d10; --card:#12161b; --ink:#e9eef4; --muted:#98a2b3; --chip:#1e2630; --accent:#6ee7b7; }
    html,body{margin:0;padding:0;background:var(--bg);color:var(--ink);font:16px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Inter,"Helvetica Neue",Arial}
    .wrap{max-width:1100px;margin:40px auto;padding:0 16px}
    h1{font-size:clamp(20px,3vw,28px);margin:0 0 12px}
    .bar{display:flex;align-items:center;gap:12px;justify-content:space-between;margin:0 0 18px}
    .count{color:var(--muted);font-size:14px}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(290px,1fr));gap:16px}
    .card{background:var(--card);border:1px solid #232a33;border-radius:14px;padding:14px;display:flex;flex-direction:column;gap:10px}
    .title{font-weight:600;font-size:16px;margin:0}
    .media{display:flex;gap:10px;flex-wrap:wrap}
    .chip{background:var(--chip);color:var(--ink);border:1px solid #2a3340;border-radius:999px;padding:4px 10px;font-size:12px}
    .chip.ia{border-color:#2a4035}
    .meta{color:var(--muted);font-size:13px}
    .actions{margin-top:auto;display:flex;gap:10px;flex-wrap:wrap}
    .btn{appearance:none;border:1px solid #2a3340;background:#141a21;color:var(--ink);padding:8px 10px;border-radius:10px;font-size:13px;text-decoration:none}
    .btn:hover{border-color:#394353}
    .btn.accent{border-color:#2a4035;background:#152019}
    .empty,.error{padding:18px;border:1px dashed #2a3340;border-radius:12px;color:var(--muted);background:#0f1318}
    details summary{cursor:pointer;list-style:none}
    details summary::-webkit-details-marker{display:none}
    .sr{position:absolute;left:-9999px}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="bar">
      <h1>Veille OSINT</h1>
      <div id="counter" class="count">Chargement…</div>
    </div>
    <div id="app" class="grid" aria-live="polite"></div>
    <div id="fallback"></div>
  </div>

  <!-- 1) Charger D’ABORD les données -->
  <script src="data_osint.js"></script>

  <!-- 2) Puis le script d’affichage -->
  <script>
    (function () {
      // Vérifs & logs utiles
      const hasArray = Array.isArray(window.RAW_ROWS);
      console.log("✔ RAW_ROWS chargées :", hasArray ? window.RAW_ROWS.length : "—");

      const app = document.getElementById('app');
      const counter = document.getElementById('counter');
      const fallback = document.getElementById('fallback');

      if (!hasArray) {
        counter.textContent = "0 élément";
        fallback.innerHTML = `
          <div class="error">
            <strong>Impossible de lire <code>window.RAW_ROWS</code>.</strong><br>
            Vérifie que <code>data_osint.js</code> est chargé <em>avant</em> ce script et que le chemin du fichier est correct.
          </div>`;
        return;
      }

      const rows = window.RAW_ROWS;

      // Mise à jour compteur
      counter.textContent = rows.length + (rows.length > 1 ? " éléments" : " élément");

      if (!rows.length) {
        fallback.innerHTML = `<div class="empty">Aucune donnée à afficher.</div>`;
        return;
      }

      // Rendu des cartes (sans filtre de dates)
      const frag = document.createDocumentFragment();

      rows.forEach((r, idx) => {
        const card = document.createElement('article');
        card.className = 'card';

        // Champs avec garde-fous
        const title = (r.title || 'Sans titre').toString();
        const media = (r.media || '—').toString();
        const theme = (r.theme || '—').toString();
        const proact = (r.proact || '').toString();
        const hasIA = !!r.hasIA;
        const date = r.date ? r.date : '—';
        const authors = Array.isArray(r.authors) ? r.authors.filter(Boolean).join(', ') : '';

        // Titre
        const h3 = document.createElement('h3');
        h3.className = 'title';
        h3.textContent = title;
        card.appendChild(h3);

        // Infos médias / thèmes
        const chips = document.createElement('div');
        chips.className = 'media';

        const chipMedia = document.createElement('span');
        chipMedia.className = 'chip';
        chipMedia.textContent = media;
        chips.appendChild(chipMedia);

        if (theme && theme !== '—') {
          const chipTheme = document.createElement('span');
          chipTheme.className = 'chip';
          chipTheme.textContent = theme;
          chips.appendChild(chipTheme);
        }

        if (proact) {
          const chipPro = document.createElement('span');
          chipPro.className = 'chip';
          chipPro.textContent = proact;
          chips.appendChild(chipPro);
        }

        if (hasIA) {
          const chipIA = document.createElement('span');
          chipIA.className = 'chip ia';
          chipIA.textContent = 'IA mentionnée';
          chips.appendChild(chipIA);
        }

        card.appendChild(chips);

        // Meta (date + auteurs)
        const meta = document.createElement('div');
        meta.className = 'meta';
        meta.textContent = `Date : ${date}` + (authors ? ` • Auteurs : ${authors}` : '');
        card.appendChild(meta);

        // Extrait / contenu
        if (r.content) {
          const details = document.createElement('details');
          const sum = document.createElement('summary');
          sum.textContent = 'Résumé';
          const p = document.createElement('p');
          p.style.margin = '8px 0 0';
          p.textContent = r.content;
          details.appendChild(sum);
          details.appendChild(p);
          card.appendChild(details);
        }

        // Actions (lien, commentaire)
        const actions = document.createElement('div');
        actions.className = 'actions';

        if (r.link && typeof r.link === 'string' && r.link.trim() !== '') {
          const a = document.createElement('a');
          a.className = 'btn accent';
          a.href = r.link;
          a.target = '_blank';
          a.rel = 'noopener';
          a.textContent = 'Ouvrir la source';
          actions.appendChild(a);
        }

        if (r.commentaire && r.commentaire.trim() !== '') {
          const c = document.createElement('button');
          c.type = 'button';
          c.className = 'btn';
          c.textContent = 'Commentaire';
          c.addEventListener('click', () => {
            alert(r.commentaire);
          });
          actions.appendChild(c);
        }

        if (actions.children.length) card.appendChild(actions);

        frag.appendChild(card);
      });

      app.innerHTML = ''; // nettoie
      app.appendChild(frag);
    })();
  </script>
</body>
</html>
