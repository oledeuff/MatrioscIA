<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>catalogue d'enquÃªtes OSINT â€” Version finale corrigÃ©e</title>
<style>
:root{
  --bg:#f7f9fb;--surface:#fff;--muted:#475569;--text:#0f172a;--accent:#16a34a;--border:#e2e8f0;--stripe:#f0fdf4;
  --ai-bg:#eef2ff;--ai-text:#3730a3;--ai-border:#dbeafe;--pro-bg:#059669;--rea-bg:#d97706;
  --t-humanitaire:#8b5cf6;--t-env:#10b981;--t-mil:#8B4513;--t-milinf:#78866B;--t-crime:#000000;--t-repression:#f97316;--t-actualite:#3b82f6;--t-catnat:#ef4444;--t-autre:#64748b;
}
body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,Helvetica Neue,Arial;background:var(--bg);color:var(--text)}
header{position:sticky;top:0;z-index:10;background:linear-gradient(120deg,#16a34a,#22c55e,#86efac);border-bottom:1px solid var(--border);padding:20px}
.container{max-width:1180px;margin:0 auto;padding:0 12px}
.grid{display:grid;gap:12px;grid-template-columns:1fr}
@media(min-width:720px){.grid{grid-template-columns:1fr 1fr}}
@media(min-width:1040px){.grid{grid-template-columns:1fr 1fr 1fr}}
.card{background:var(--surface);border:1px solid var(--border);border-radius:14px;padding:12px;box-shadow:0 6px 14px rgba(15,23,42,.05);display:flex;flex-direction:column;gap:8px}
.logo{width:40px;height:40px;border-radius:8px;border:1px solid var(--border);object-fit:contain;background:#fff}
.logo-fallback{width:40px;height:40px;border-radius:8px;background:#e2e8f0;color:#334155;display:flex;align-items:center;justify-content:center;font-weight:700}
.chips{display:flex;gap:6px;flex-wrap:wrap}
.chip{padding:2px 8px;border-radius:999px;font-size:12px}
.chip-ia{background:var(--ai-bg);color:var(--ai-text)}
.chip-pro{background:var(--pro-bg);color:#fff}
.chip-rea{background:var(--rea-bg);color:#fff}
.theme{padding:2px 8px;border-radius:999px;font-size:12px;color:#fff}
footer{margin:28px 0;color:#065f46;font-size:13px}
footer .foot{padding:14px;border:1px solid var(--border);border-radius:12px;background:linear-gradient(120deg,#ecfdf5,#f0fdf4)}
</style>
</head>
<body>
<header>
  <div class="container">
    <h1>catalogue d'enquÃªtes de type OSINT</h1>
    <p>Investigations audiovisuelles â€” version finale corrigÃ©e</p>
    <div>
      <input id="q" placeholder="Rechercheâ€¦"/>
      <select id="ia"><option value="">IA?</option><option value="y">Oui</option><option value="n">Non</option></select>
      <select id="pro"><option value="">Type</option><option value="proactive">Proactive</option><option value="reactive">RÃ©active</option></select>
      <select id="media"></select>
      <select id="author"></select>
      <select id="theme"></select>
      <input id="dfrom" type="date"/> <input id="dto" type="date"/>
      <button id="clear">RÃ©initialiser</button>
      <span id="count"></span>
    </div>
  </div>
</header>
<main class="container">
  <div id="grid" class="grid"></div>
  <footer><div class="foot">Projet MatrioscIA. 2025. Licence CC BY.</div></footer>
</main>

<script>
// DonnÃ©es
const SAMPLE=[{title:"Exemple",content:"RÃ©sumÃ©",begin:"2023-01-01",media:"Le Monde","meta:links":"https://www.lemonde.fr",commentaire:"",auteurs:"Dupont|Durand",thÃ©matique:"stratÃ©gies militaires et influence","proactivitÃ©/rÃ©activitÃ©":"rÃ©active"}];
const RAW=(window.DATA&&Array.isArray(window.DATA)?window.DATA:SAMPLE);

// Utils
const str=s=>(s||"").toString();
const norm=s=>str(s).normalize('NFD').replace(/\p{Diacritic}/gu,'').toLowerCase();
function parseDate(val){const d=new Date(val);return isNaN(d)?null:d;}

function firstURL(val){const raw=val==null?'':String(val).trim();const urlRe=/(https?:\/\/)?([\w-]+\.)+[\w-]{2,}(\/[\w\-._~:\/?#[\]@!$&'()*+,;=%]*)?/i;try{const p=JSON.parse(raw);if(Array.isArray(p)){for(const x of p){const m=String(x).match(urlRe);if(m)return m[0].startsWith('http')?m[0]:'https://'+m[0];}}else if(p&&typeof p==='object'){for(const v of Object.values(p)){const m=String(v).match(urlRe);if(m)return m[0].startsWith('http')?m[0]:'https://'+m[0];}}}catch(_){}const m=raw.match(urlRe);return m?(m[0].startsWith('http')?m[0]:'https://'+m[0]):'';}

// Logos
const LOGOS={
 'Le Monde':'https://upload.wikimedia.org/wikipedia/commons/5/57/Le_Monde.svg',
 'The New York Times':'https://upload.wikimedia.org/wikipedia/commons/0/0e/The_New_York_Times_logo_variation.jpg',
 'Washington Post':'https://upload.wikimedia.org/wikipedia/commons/0/0b/Washington_Post_logo_2014.svg',
 'BBC':'https://upload.wikimedia.org/wikipedia/commons/3/3f/BBC_Logo_2021.svg',
 'Arte':'https://upload.wikimedia.org/wikipedia/commons/8/8c/Arte_Logo_2017.svg',
 'AFP':'https://upload.wikimedia.org/wikipedia/commons/9/9a/Agence_France-Presse_logo.svg',
 'LibÃ©ration':'https://upload.wikimedia.org/wikipedia/commons/0/0b/Logo_Lib%C3%A9ration.svg',
 'Le Figaro':'https://upload.wikimedia.org/wikipedia/commons/4/46/Le_Figaro_logo_2009.svg',
 'Mediapart':'https://upload.wikimedia.org/wikipedia/commons/b/bf/Mediapart_logo.svg',
 'France 24':'https://upload.wikimedia.org/wikipedia/commons/2/2e/France_24_logo.svg',
 'Reuters':'https://upload.wikimedia.org/wikipedia/commons/5/59/Reuters_Logo.svg',
 'The Guardian':'https://upload.wikimedia.org/wikipedia/commons/0/0e/The_Guardian_2018.svg',
 'Associated Press':'https://upload.wikimedia.org/wikipedia/commons/3/3b/Associated_Press_logo_2012.svg',
 'Bellingcat':'https://upload.wikimedia.org/wikipedia/commons/0/0f/Bellingcat_logo.svg'
};

// ThÃ©matiques couleurs
const THEME_COLORS={
 'humanitaire':'#8b5cf6','problematiques environnementales':'#10b981','strategies militaires':'#8B4513','strategies militaires et influence':'#78866B','crime organise':'#000000','repression de letat':'#f97316','approfondissement de lactualite':'#3b82f6','catastrophes naturelles':'#ef4444'
};

function contrast(hex){const h=hex.replace('#','');let r=parseInt(h.substring(0,2),16),g=parseInt(h.substring(2,4),16),b=parseInt(h.substring(4,6),16);const lum=(0.299*r+0.587*g+0.114*b)/255;return lum>0.55?'#111':'#fff';}

// Normalisation auteurs
function splitAuthors(raw){const parts=(raw||'').split(/\s*(?:\||,|;|\/|\bet\b|&|\band\b)\s*/i).map(s=>s.trim()).filter(Boolean);const seen=new Set(),out=[];for(const p of parts){const k=norm(p);if(!seen.has(k)){seen.add(k);out.push(p);}}return out;}

// Enrichissement
const ENRICHED=RAW.map(r=>{
 const title=str(r.title),content=str(r.content),media=str(r.media);
 const link=firstURL(r["meta:links"]||r.link||'');
 const date=parseDate(r.begin);
 const authors=splitAuthors(r.auteurs||r.authors_raw||'');
 const theme=str(r.thÃ©matique||'').trim();
 const themeKey=norm(theme).replace(/â€™/g,"'");
 const themeColor=THEME_COLORS[themeKey]||'#64748b';
 const proact=norm(r["proactivitÃ©/rÃ©activitÃ©"]||'').includes('react')?'reactive':(norm(r["proactivitÃ©/rÃ©activitÃ©"]||'').includes('proact')?'proactive':'');
 const ia=/\b(ai|i\.a\.|intelligence artificielle|machine learning)\b/i.test(title+content+r.commentaire)?'y':'n';
 return {title,content,media,date,link,authors,theme,themeKey,themeColor,proact,ia};
});

// Filtres
const medias=[...new Set(ENRICHED.map(x=>x.media))].sort();
const authors=[...new Set(ENRICHED.flatMap(x=>x.authors))].sort();
const themes=[...new Set(ENRICHED.map(x=>x.theme))];

function setOptions(el,arr,placeholder){el.innerHTML='';if(placeholder){const o=document.createElement('option');o.value='';o.textContent=placeholder;el.appendChild(o);}arr.forEach(v=>{const o=document.createElement('option');o.value=v;o.textContent=v;el.appendChild(o);});}
setOptions(document.getElementById('media'),medias,'(tous)');
setOptions(document.getElementById('author'),authors,'(tous)');
setOptions(document.getElementById('theme'),themes,'(toutes)');

// Rendu cartes
function card(r){
 const logo=LOGOS[r.media]||'';
 const dateStr=r.date?new Intl.DateTimeFormat('fr-FR',{year:'numeric',month:'long',day:'2-digit'}).format(r.date):'';
 return `<div class="card" style="border-left:8px solid ${r.themeColor}">
   <div style="display:flex;align-items:center;gap:8px">
     ${logo?`<img class="logo" src="${logo}" alt="${r.media}">`:`<div class="logo-fallback">${(r.media||'?').slice(0,2).toUpperCase()}</div>`}
     <h3>${r.title}</h3>
   </div>
   <p>${r.content}</p>
   <div class="chips">
     <span class="chip">${r.media}</span>
     ${r.ia==='y'?`<span class="chip chip-ia">IA</span>`:''}
     ${r.proact==='proactive'?`<span class="chip chip-pro">Proactive</span>`:''}
     ${r.proact==='reactive'?`<span class="chip chip-rea">RÃ©active</span>`:''}
     <span class="theme" style="background:${r.themeColor};color:${contrast(r.themeColor)}">${r.theme||'Sans thÃ©matique'}</span>
     ${r.authors.map(a=>`<span class="chip">${a}</span>`).join('')}
   </div>
   <div style="display:flex;justify-content:space-between;font-size:12px;color:#475569">
     <span>${dateStr}</span>
     ${r.link?`<a href="${r.link}" target="_blank" rel="noopener">ðŸ”—</a>`:''}
   </div>
 </div>`;
}

// Filtrage
function applyFilters(){
 const q=document.getElementById('q').value.toLowerCase();
 const ia=document.getElementById('ia').value;
 const pro=document.getElementById('pro').value;
 const media=document.getElementById('media').value;
 const author=document.getElementById('author').value;
 const theme=document.getElementById('theme').value;
 const dfrom=document.getElementById('dfrom').value;
 const dto=document.getElementById('dto').value;
 let out=ENRICHED.filter(r=>{
   if(q && !(r.title+r.content).toLowerCase().includes(q)) return false;
   if(ia && r.ia!==ia) return false;
   if(pro && r.proact!==pro) return false;
   if(media && r.media!==media) return false;
   if(author && !(r.authors||[]).includes(author)) return false;
   if(theme && r.theme!==theme) return false;
   if(dfrom && (!r.date || r.date<new Date(dfrom))) return false;
   if(dto){const d=new Date(dto);d.setHours(23,59,59,999);if(!r.date||r.date>d)return false;}
   return true;
 });
 document.getElementById('grid').innerHTML=out.map(card).join('');
 document.getElementById('count').textContent=`${out.length} rÃ©sultat(s)`;
}

['q','ia','pro','media','author','theme','dfrom','dto'].forEach(id=>document.getElementById(id).addEventListener('input',applyFilters));
document.getElementById('clear').addEventListener('click',()=>{['q','ia','pro','media','author','theme','dfrom','dto'].forEach(id=>document.getElementById(id).value='');applyFilters();});

applyFilters();
</script>
</body>
</html>
